<!DOCTYPE html>
<html>
<head>
	<title>CRC 과제 안전지수 계산</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<style>
        canvas {
            padding-left: 0;
            padding-right: 0;
            margin-left: auto;
            margin-right: auto;
        }
		form {
			max-width: 600px;
			margin: 0 auto;
			text-align: left;
		}
		label {
			display: block;
			margin-bottom: 10px;
		}
		input {
			display: block;
			width: 100%;
			padding: 10px;
			border: 1px solid #ccc;
			border-radius: 4px;
			box-sizing: border-box;
			margin-bottom: 20px;
		}
		button {
			background-color: #4CAF50;
			color: white;
			padding: 10px 20px;
			border: none;
			border-radius: 4px;
			cursor: pointer;
		}
        .hr {
			border-top: 1px solid #ccc;
			margin: 20px 0;
		}
        canvas {
            max-width: 300px;
        }
	</style>
	<script>
        function pearsonCorrelation(x, y) {
            if (x.length !== y.length) {
                //throw "same length";
            }

            var n = x.length;

            var sumX = 0, sumY = 0, sumXY = 0, sumX2 = 0, sumY2 = 0;
            for (var i = 0; i < n; i++) {
                sumX += x[i];
                sumY += y[i];
                sumXY += x[i] * y[i];
                sumX2 += x[i] * x[i];
                sumY2 += y[i] * y[i];
            }

            var numerator = (n * sumXY) - (sumX * sumY);
            var denominator = Math.sqrt((n * sumX2 - sumX * sumX) * (n * sumY2 - sumY * sumY));

            return numerator / (denominator + Math.random()/100); // xxx
        }
        function calc_index(A, B, C, D, a, b, c) {
            var answer = 0;

            for(var i = 0; i < A.length; i++)
                answer += parseInt(A[i]);
            var AA = answer / A.length;
            answer = 0;
            for(var i = 0; i < B.length; i++)
                answer += parseInt(B[i]);
            var BB = answer / B.length;
            answer = 0;
            for(var i = 0; i < C.length; i++)
                answer += parseInt(C[i]);
            var CC = answer / C.length;
            answer = 0;
            for(var i = 0; i < D.length; i++)
                answer += parseInt(D[i]);
            var DD = answer / D.length;
            
            return Math.sqrt(AA**2 + (a*BB)**2 + (b*CC)**2 + (c*DD)**2);
        }
		function onSubmit() {
            /*
			alert("Values submitted:\n"
				+ "Question 1: " + document.getElementById("q1").value + "\n"
				+ "Question 2: " + document.getElementById("q2").value + "\n"
				+ "Question 3: " + document.getElementById("q3").value + "\n"
				+ "Question 4: " + document.getElementById("q4").value + "\n"
				+ "Question 5: " + document.getElementById("q5").value + "\n"
				+ "Question 6: " + document.getElementById("q6").value + "\n"
				+ "Question 7: " + document.getElementById("q7").value + "\n"
				+ "Question 8: " + document.getElementById("q8").value);
*/
                var q1 = parseInt(document.getElementById("q1").value);
                var q2 = parseInt(document.getElementById("q2").value);
                var q3 = parseInt(document.getElementById("q3").value);
                var q4 = parseInt(document.getElementById("q4").value);
                var q5 = parseInt(document.getElementById("q5").value);
                var q6 = parseInt(document.getElementById("q6").value);
                var q7 = parseInt(document.getElementById("q7").value);
                var q8 = parseInt(document.getElementById("q8").value);

                // dummy data = 3(avg)
                var A = [q1, q2, q3];
                var B = [2, 3, 4];
                var C = [q4, q5, 3];
                var D = [q6, q7, q8];

                var a = pearsonCorrelation(A, D);
                var b = pearsonCorrelation(A, B);
                var c = pearsonCorrelation(A, C);
                var d = pearsonCorrelation(B, D);
                var e = pearsonCorrelation(B, C);
                var f = pearsonCorrelation(C, D);
                //생체-환경
                //생체-사물
                //사물-환경
                var newA = calc_index(A, D, B, C, a, b, c);
                var newB = calc_index(B, A, D, C, b, d, e);
                var newC = calc_index(C, B, C, D, c, e, f);
                var newD = calc_index(D, A, D, B, a, d, f);

                var temp;
                if (Math.max(newA, newB, newC, newD) > 10)
                    temp = 10;
                else
                    temp = (newA+newB+newC+newD) / 4;
                temp = 10 - temp;
                document.getElementById("survey").innerHTML= "";
                document.getElementById("result").style.display = "block";
                document.getElementById("label1").innerText = "생체-환경 상관계수 : " + a;
                document.getElementById("label2").innerText = "생체-사물손상 상관계수 : " + c;
                document.getElementById("label3").innerText = "사물손상-환경 상관계수 : " + f;
                document.getElementById("label4").innerText = "안전지수(0~10) : " + temp;

                var ctx1 = document.getElementById("myChart1").getContext("2d");
                var myChart = new Chart(ctx1, {
                    data: {
                            type: "scatter",
                        datasets: [{
                            type: "scatter",
                            label: "f(생체) = 환경",
                            data: [{
                                x: A[0],
                                y: D[0]
                            }, {
                                x: A[1],
                                y: D[1]
                            }, {
                                x: A[2],
                                y: D[2]
                            }],
                            pointBackgroundColor: "blue",
                            pointRadius: 8, // Set point size
                        }]
                    },
                    options: {
                        scales: {
                            xAxes: [{
                                title: {
                                    display: true,
                                    text: "생체지표"
                                },
                                type: "linear",
                                position: "bottom",
                                scaleLabel: {
                                    display: true,
                                    labelString: "생체지표"
                                }
                            }],
                            yAxes: [{
                                title: {
                                    display: true,
                                    text: "환경지표"
                                },
                                type: "linear",
                                position: "left",
                                scaleLabel: {
                                    display: true,
                                    labelString: "환경지표"
                                }
                            }]
                        }
                    }
                });
                
                var ctx2 = document.getElementById("myChart2").getContext("2d");
                var myChart = new Chart(ctx2, {
                    data: {
                            type: "scatter",
                        datasets: [{
                            type: "scatter",
                            label: "f(생체) = 사물손상",
                            data: [{
                                x: A[0],
                                y: C[0]
                            }, {
                                x: A[1],
                                y: C[1]
                            }, {
                                x: A[2],
                                y: C[2]
                            }],
                            pointBackgroundColor: "blue",
                            pointRadius: 8, // Set point size
                        }]
                    },
                    options: {
                        scales: {
                            xAxes: [{
                                title: {
                                    display: true,
                                    text: "생체지표"
                                },
                                type: "linear",
                                position: "bottom",
                                scaleLabel: {
                                    display: true,
                                    labelString: "생체지표"
                                }
                            }],
                            yAxes: [{
                                title: {
                                    display: true,
                                    text: "사물손상지표"
                                },
                                type: "linear",
                                position: "left",
                                scaleLabel: {
                                    display: true,
                                    labelString: "사물손상지표"
                                }
                            }]
                        }
                    }
                });

                var ctx3 = document.getElementById("myChart3").getContext("2d");
                var myChart = new Chart(ctx3, {
                    data: {
                            type: "scatter",
                        datasets: [{
                            type: "scatter",
                            label: "f(사물손상) = 환경",
                            data: [{
                                x: C[0],
                                y: D[0]
                            }, {
                                x: C[1],
                                y: D[1]
                            }, {
                                x: C[2],
                                y: D[2]
                            }],
                            pointBackgroundColor: "blue",
                            pointRadius: 8, // Set point size
                        }]
                    },
                    options: {
                        scales: {
                            xAxes: [{
                                title: {
                                    display: true,
                                    text: "사물손상지표"
                                },
                                type: "linear",
                                position: "bottom",
                                scaleLabel: {
                                    display: true,
                                    labelString: "사물손상지표"
                                }
                            }],
                            yAxes: [{
                                title: {
                                    display: true,
                                    text: "환경지표"
                                },
                                type: "linear",
                                position: "left",
                                scaleLabel: {
                                    display: true,
                                    labelString: "환경지표"
                                }
                            }]
                        }
                    }
                });
        }
	</script>
</head>
<body>
	<div style="text-align:center;">
		<h1>CRC과제 안전지수 계산</h1>
        <div id="survey">
            <p style="font-weight: bold;"> 이 페이지는 CRC과제에 대한 연구 목적으로 작성 되었으며, 웨어러블 기기의 측정 값을 토대로 안전지수를 산출하기 위한 과정을 보여줍니다. </br>
                질문 내용은 측정 가능한 데이터를 임의로 선정한 것이며, 실제와 상이할 수 있습니다. </br>
                작성한 임의의 센서 측정 값을 토대로 안전지수 산출 공식에 의해 안전지수(0~10)를 도출합니다. </br>
                4가지 지표(생체, 심리, 사물손상, 환경) 중 심리 지표는 고려되지 않았습니다. </br>
                작성한 데이터는 어디에도 저장되지 않습니다.  </br>
            </p>
            <hr class="hr">
        </br>
            <form>
                <label style="font-weight: bold;">생존신호정보 중 생체지표에 관련된 항목입니다.</label>            </br>
                <label for="q1">현재 심박수(bpm)</label>
                <input type="number" id="q1" required/>

                <label for="q2">현재 체온(°C)</label>
                <input type="number" id="q2"required/>

                <label for="q3">산소포화도 센서의 값(%)</label>
                <input type="number" id="q3" required/>
            </br>            </br>
                <label style="font-weight: bold;">생존신호정보 중 사물손상지표에 관련된 항목입니다.</label>            </br>
                <label for="q4">안전모에 가해진 충격량(N)</label>
                <input type="number" id="q4" required/>

                <label for="q5">낙상 감지 시 가속도계 측정 값(m/s²)</label>
                <input type="number" id="q5" required/>
            </br>            </br>
                <label style="font-weight: bold;">생존신호정보 중 환경지표에 관련된 항목입니다.</label>            </br>
                <label for="q6">공기오염도(CAI)</label>
                <input type="number" id="q6" required/>

                <label for="q7">현재 온도(°C)</label>
                <input type="number" id="q7" required/>

                <label for="q8">현재 고도(m)</label>
                <input type="number" id="q8" required/>
            </br>
                <button type="submit" onclick="onSubmit()">Submit</button>
            </form>

        </div>
        <div id="result" style="display:none">
            <img width="400" src="https://i.imgur.com/95FzMrL.png"></br>
            <canvas id="myChart1" width="700" height="450"></canvas>
            <strong id="label1"></strong> </br></br></br>
            <canvas id="myChart2" width="700" height="450"></canvas>
            <strong id="label2"></strong></br></br></br>
            <canvas id="myChart3" width="700" height="450"></canvas>
            <strong id="label3"></strong></br></br></br></br></br>

            <strong id="label4"></strong></br></br></br>
        </div>
	</div>
</body>
</html>
